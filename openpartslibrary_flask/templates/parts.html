<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parts</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='bootstrap-5.3.3-dist/css/bootstrap.min.css') }}">
</head>
<body style="margin: 0; padding: 0; min-height: 100vh;">
    <style>
        .table-hover tbody tr:hover {
            background-color: #d3d3d3;
            cursor: pointer;
        }
        /* Highlight for selected row */
        .table-hover tbody tr.selected-row > td{
            background-color: #cfe2ff !important;
        }
        .prevent-select {
            -webkit-user-select: none; /* Safari */
            -ms-user-select: none; /* IE 10 and IE 11 */
            user-select: none; /* Standard syntax */
        }

        tbody tr td {
            white-space: nowrap;   /* keep text on one line */
            overflow: hidden;      /* hide the extra text */
            text-overflow: ellipsis; /* show ... at the end */
        }
    </style>
    <div class="container-fluid px-1 py-1" style="margin: 0; padding: 0; min-height: 40px; max-height: 40px; background-color: #f5f5f5; border-bottom: 1px solid lightgray;">
        <div class="row p-0 m-0">
            <div class="col-md-3 p-0 m-0">
                <a type="button" class="btn btn-outline-secondary btn-sm" href="{{ url_for('create_part') }}" style="font-size: smaller;">
                    <img src="{{ url_for('static', filename = 'bootstrap-icons-1.11.3/plus.svg') }}" width="20" height="20">New part
                </a>
            </div>
            <div class="col-md-6 col-md-auto mb-2 justify-content-center p-0 m-0">
            </div>
            <div class="col-md-3 text-end p-0 m-0" >
                <a type="button" class="btn btn-outline-secondary btn-sm " href="#">
                    <img class="pb-1" src="{{ url_for('static', filename = 'bootstrap-icons-1.11.3/list.svg') }}" width="16" height="16">
                </a>
                <a type="button" class="btn btn-outline-secondary btn-sm " href="#">
                    <img class="pb-1" src="{{ url_for('static', filename = 'bootstrap-icons-1.11.3/layout-split.svg') }}" width="16" height="16">
                </a>
                <!-- other view buttons
                <a type="button" class="btn btn-outline-secondary btn-sm " href="#">
                    <img class="pb-1" src="{{ url_for('static', filename = 'bootstrap-icons-1.11.3/layout-sidebar-reverse.svg') }}" width="16" height="16">
                </a>
                <a type="button" class="btn btn-outline-secondary btn-sm " href="#">
                    <img class="pb-1" src="{{ url_for('static', filename = 'bootstrap-icons-1.11.3/share.svg') }}" width="16" height="16">
                </a>
                 -->
            </div>
        </div>
    </div>
    <div class="row prevent-select" style="margin: 0; padding: 0; min-height: calc(100vh - 41px); max-height: calc(100vh - 41px);">
        <!-- List -->
        <div class="col-6 m-0" style="overflow-y: scroll; overflow-x: scroll; min-height: calc(100vh - 40px); max-height: calc(100vh - 40px); background-color: #f5f5f5; border: none; padding: 0; border-right: 1px solid lightgray;">
            <h1 class="p-3 pb-0 mb-1" style="font-size: x-large;">Parts</h1>
            <p class="mb-3 px-3 py-0">{{ len(parts) }} parts were found.</p>
            <table class="table table-hover" style="outline-style: solid; outline-color: lightgray; outline-width: 1px;">
                <thead>
                    <tr>
                        <th></th>
                        <th>Name</th>
                        <th>Part number</th>
                        <th>Material</th>
                        <th>Supplier</th>
                        <th>Unit price</th>
                    </tr>
                </thead>
                <tbody>
                    {% for part in parts %}
                    <tr class="part-row" data-model="{{ part.cad_reference.uuid }}.FCStd">
                        <td style="min-width: 54px; max-width: 54px;">
                            <a type="button" class="btn btn-outline-secondary btn-sm " href="{{ url_for('part_view', uuid = part.uuid ) }}">
                                <img class="pb-1" src="{{ url_for('static', filename = 'bootstrap-icons-1.11.3/eye.svg') }}" width="18" height="18">
                            </a>
                        </td>
                        <td style="min-width: 260px; max-width: 260px;">{{ part.name }}</td>
                        <td style="min-width: 120px; max-width: 120px;">{{ part.number }}</td>
                        <td style="min-width: 120px; max-width: 120px;">{{ part.material }}</td>
                        <td style="min-width: 220px; max-width: 220px;">{{ part.supplier.name }}</td>
                        <td style="min-width: 100px; max-width: 100px;">{{ part.unit_price }} {{ part.currency }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <!-- 3D View -->
        <div class="col-6 p-0 m-0" style="min-height: calc(100vh - 40px); max-height: calc(100vh - 40px); background-color: rgb(245, 245, 245);">
            <iframe id="main-view-iframe" src="" frameborder="0" style="min-width: 100%; min-height: calc(100vh - 40px); max-height: calc(100vh - 40px); margin: 0; display: block;"></iframe>
        </div>
    </div>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('.part-row').forEach(function(row) {
            row.addEventListener('click', function() {
                // Remove 'selected-row' class from all rows
                document.querySelectorAll('.part-row').forEach(function(r) {
                    r.classList.remove('selected-row');
                });
                // Add 'selected-row' class to the clicked row
                row.classList.add('selected-row');

                var modelFile = this.getAttribute('data-model');
                console.log("Clicked row, model filename: ", modelFile);
                if (modelFile) {
                    var iframe = document.getElementById('main-view-iframe');
                    iframe.src = '/viewer/' + encodeURIComponent(modelFile);
                    console.log("Set iframe src to: " , iframe.src);
                }
            }); 
        });
    });
    </script>

</body>
</html>